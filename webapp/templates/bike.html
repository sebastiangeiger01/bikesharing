<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css"
    integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14=" crossorigin="" />
  <!-- Make sure you put this AFTER Leaflet's CSS -->
  <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
    integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg=" crossorigin=""></script>
  <link rel="stylesheet" href="static/assets/bootstrap/css/style1.css">
</head>


<!-- Navigationsleiste und Footer importieren -->
{% extends 'base.html' %}
{%block content%}

<!-- Bike section-->
<section class="py-5">
  <div class="container px-4 px-lg-5 my-5">
    <div class="row gx-4 gx-lg-5 align-items-center">
      <div class="col-md-6"><img class="card-img-top mb-5 mb-md-0"
          style="box-shadow: 0px 10px 15px -3px rgba(0,0,0,0.1); border-radius: 5% 5% 5% 5% / 5% 5% 5% 5%;"
          src="static/assets/img/Produktbild.png" alt="{{ bike.name }}" /></div>
      <div class="col-md-6">
        <div class="small mb-1">Bike-ID:{{ bike.id }}</div>
        <h1 class="display-5 fw-bolder">{{ bike.name }}</h1>
        <div class="fs-5 mb-5">
          <span class="text-decoration-line-through">5,00 €</span>
          <span>3,50 € je angefangene Stunde</span>
        </div>
    
        <div class="fs-5 mb-5">
          <span>Adresse: <div id="address" style="font-size: smaller;"></div></span>
        </div>

        <div id="map" style="width: 100%; height: 100px;"></div>


          <script>
          var map = L.map('map').setView([{{ bike.y_coordinate }}, {{ bike.x_coordinate }}], 13);

          var tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
          }).addTo(map);

          var marker = L.marker([{{ bike.y_coordinate }}, {{ bike.x_coordinate }}]).addTo(map);



        </script>















        <!-- Script um Adresse anzuzeigen-->
        <script>
          // Rufe Nominatim-API auf, um Adresse zu erhalten
          var url = "https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat={{ bike.y_coordinate }}&lon={{ bike.x_coordinate }}";
          fetch(url)
            .then((response) => response.json())
            .then((data) => {
              // Zeige Adresse an
              document.getElementById("address").innerHTML = data.display_name;
            });
        </script>

        <div class="fs-5 mb-5">
          Erlebe die Freiheit des Radfahrens mit unserem hochwertigen Fahrrad! Mit seinem leichten
          Aluminiumrahmen und den robusten Reifen bist du für jedes Abenteuer gerüstet. Ob auf dem Weg zur Arbeit oder
          beim Wochenendausflug – mit dem Fahrrad bist du immer schnell und bequem unterwegs.
        </div>


        <div class="d-flex">
          <div class="container">
            <form action="/bike{{ bike.id }}" method="PUT">
              <script>
                document.addEventListener("DOMContentLoaded", function () {
                  const startTimeField = document.getElementById("start-time");
                  const currentTime = new Date();
                  const formattedTime = currentTime.toISOString().replace(/\..+/, '').replace('T', ' '); // remove milliseconds and replace "T" with a space
                  startTimeField.value = formattedTime;
                });
              </script>
              <input type="datetime" name="start_time" placeholder="Start Time" id="start-time"
                value="YYYY-MM-DD hh:mm:ss">
              <button type="submit" class="btn btn-primary" id="rent-button">{{ status }} rent</button>
            </form>
          </div>
          <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
          <script>
            $('#rent-button').click(function () {
              jQuery.ajax({
                url: "http://localhost/bike{{ bike.id }}",
                type: "POST",
                headers: {
                  "X-CSRF-Token": "{{csrf_token()}}",
                  "Content-Type": "application/json; charset=utf-8",
                },
                contentType: "application/json",
                data: JSON.stringify({
                  "start_time": $('#start-time').val()
                })
              })
                .done(function (data, textStatus, jqXHR) {
                  console.log("HTTP Request Succeeded: " + jqXHR.status);
                  console.log(data);
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                  console.log("HTTP Request Failed");
                })
                .always(function () {
                  /* ... */
                });
            });
          </script>
          <form action="/bike{{ bike.id }}" method="PUT">
            <div class="container"></div>
            <script>
              document.addEventListener("DOMContentLoaded", function () {
                const endTimeField = document.getElementById("end-time");
                const currentTime = new Date();
                const formattedTime = currentTime.toISOString().replace(/\..+/, '').replace('T', ' '); // remove milliseconds and replace "T" with a space
                endTimeField.value = formattedTime;
              });
            </script>
            <input type="datetime" name="end_time" placeholder="End Time" id="end-time" value="YYYY-MM-DD hh:mm:ss">
            <button type="submit" class="btn btn-primary" id="return-button">{{ status }} return</button>
        </div>
        </form>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
          $('#return-button').click(function () {
            jQuery.ajax({
              url: "http://localhost/bike{{ bike.id }}",
              type: "PUT",
              headers: {
                "X-CSRF-Token": "{{csrf_token()}}",
                "Content-Type": "application/json; charset=utf-8",
              },
              contentType: "application/json",
              data: JSON.stringify({
                "end_time": $('#end-time').val()
              })
            })
              .done(function (data, textStatus, jqXHR) {
                console.log("HTTP Request Succeeded: " + jqXHR.status);
                console.log(data);
              })
              .fail(function (jqXHR, textStatus, errorThrown) {
                console.log("HTTP Request Failed");
              })
              .always(function () {
                /* ... */
              });
          });
        </script>
      </div>
    </div>
  </div>
  </div>
</section>
</div>
{% endblock %}
</body>

</html>
